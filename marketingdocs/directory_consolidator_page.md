## Directory Consolidator — когда каждая папка на своём месте

Directory Consolidator — консольное приложение для macOS, которое превращает разрозненные папки в чистую, прозрачную структуру. Пользователь поочерёдно перечисляет от одной до 100 000 исходных директорий и задаёт место назначения, а дальше инструмент берёт на себя всё остальное: проверяет целевой путь, создаёт его при необходимости, аккуратно очищает от старых артефактов и запускает консолидацию с контролируемой точностью. В итоге команда получает полный набор уникальных файлов, отсортированных по исходной структуре без дубликатов и пустых папок, а процесс остаётся прозрачным благодаря Rich-прогрессу и подробному логу операций.

### Зачем это нужно командам

- **Единый источник правды.** Проектные архивы, медиабиблиотеки и бэкапы собираются в один эталонный набор без ручного сравнения.
- **Экономия времени.** SHA-256 подсчитывается автоматически, а интерфейс командной строки подсказывает пути и защищает от ошибок выбора.
- **Управление качеством.** Логи по каждому объекту помогают сразу увидеть, что обработано и как решены конфликты.

### Ключевые преимущества

1. **Точность на уровне хэшей.** Приложение сравнивает содержимое по SHA-256 и копирует только уникальные файлы; дубликаты пропускаются, а конфликты имён решаются датовыми модификаторами прямо в названии (`__YYMMDD[-HH][-MM][-SS][_#]`).
2. **Защита от человеческих ошибок.** Целевая директория должна быть пустой: инструмент либо требует выбрать чистый путь, либо предлагает автоматическое удаление содержимого перед стартом с явным подтверждением.
3. **Чистая финальная структура.** После копирования запускается автоматическая уборка пустых подпапок и системных артефактов Finder, чтобы не оставалось «скелетов» от удалённых файлов.
4. **Наглядный прогресс.** В консоли отображается статус хэширования и копирования, каждый файл фиксируется в Rich-логе, а проблемные пути сразу попадают в `consolidator_errors.log`.
5. **Удобный интерфейс.** Автодополнение путей, валидация вложенности директорий и понятные подсказки делают работу с инструментом лёгкой даже для людей без навыков скриптинга.

### Где особенно полезен Directory Consolidator

- **Креативные студии и маркетинговые команды.** Быстро собирают исходники дизайна, фото и видео от разных подрядчиков в единую медиатеку без риска потерять раритетные версии.
- **Разработчики и DevOps.** Консолидируют снапшоты конфигураций, артефакты сборок или наборы тестовых данных, сохраняя только уникальные файлы.
- **IT-отделы в компаниях.** Наводят порядок в пользовательских архивах перед миграцией на новую инфраструктуру или передают вендору аккуратный пакет данных.
- **Фрилансеры и консультанты.** Систематизируют полученные от заказчиков материалы, чтобы быстрее стартовать проект и поддерживать прозрачность поставки.

### Как проходит работа

1. Пользователь запускает `dir-consolidator` или `python -m consolidator.app`.
2. Инструмент поочерёдно предлагает перечислить любое число исходных папок (до 100 000) и указать папку результата, проверяет, что пути не вложены друг в друга и что целевой каталог чистый.
3. Приложение потоково подсчитывает SHA-256 каждого файла, выводит прогресс и лог, копирует уникальные объекты в результирующую структуру, а конфликты имён решает автоматически.
4. После завершения удаляются пустые директории и системные артефакты, а в консоли отображается статистика — сколько файлов обработано, сколько дубликатов пропущено и сколько времени заняла операция.

### Форматы поставки

- **Установка через pip.** Нужен Python 3.10+: `pip install .` разворачивает CLI `dir-consolidator`.
- **Standalone-бандлы.** Скрипт `scripts/build_executable.sh` собирает PyInstaller‑бинарь под текущую архитектуру (`dist/macos-<архитектура>/dir-consolidator`), а при наличии Rosetta можно собрать x86_64 вариант и объединить universal2 через `lipo`.
- **Офлайн-доставка.** Итоговый `dist/dir-consolidator-universal` подходит для пользователей без установленного Python — достаточно выдать один файл. SHA-256 и smoke-логи фиксируются в README (раздел «PyInstaller артефакты»).

### Контроль точности

Автоматический проверочный сценарий `scripts/smoke_accuracy.py` создаёт временные тестовые папки, прогоняет реальный процесс объединения и сравнивает множества SHA-256 источников и результата. Любое расхождение немедленно останавливает выполнение, поэтому каждое обновление подтверждается проверкой. Ключевые правила работы интерфейса зафиксированы в `README.md`, так что продуктовые и технические команды понимают, как контролируются риски дубликатов.

### Быстрый старт

- Требуется Python 3.10+ и стандартная установка через `pip install .`.
- Для single-file сборки в README описана процедура PyInstaller и объединение universal2.
- Документация в `README.md`, `docs/architecture.md` и `docs/testing.md` охватывает архитектуру, контрольные хэши и подход к проверке качества.

Вы получаете инструмент, который мгновенно наводит порядок и даёт прозрачный результат. Directory Consolidator снимает вопрос доверия к финальному архиву: если файл уникален, он попадёт в итоговую папку; если нет — вы увидите это в логе. Одна команда, один архив, никаких сюрпризов.

### Текущий статус релиза

- **CLI готов к поставке.** Приложение ставится из исходников, smoke-сценарий `scripts/smoke_accuracy.py` проходит полностью и подтверждает точность по SHA-256.
- **Standalone-бинарь arm64 в дистрибуции.** PyInstaller-сборка находится в `dist/macos-arm64/dir-consolidator`; x86_64 и universal2 формируются тем же скриптом после установки Rosetta и universal Python, а SHA-256 всех трёх артефактов опубликованы в README.
- **Документация синхронизирована.** README, архитектура и тестирование описывают последние изменения, контрольные хэши и правила дедупликации.
- **Field Runs >10 GB пока отложены.** Масштабные бенчмарки вернём в дорожную карту после появления лимитов; текущий baseline ~3.8 MB задокументирован в `docs/testing.md`.
